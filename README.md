soupault
========

Soupault is a static website generator based on HTML rewriting rather than template
processing. It is based on the [lambdasoup](http://aantron.github.io/lambdasoup/) library and named after
the French dadaist and surrealist poet Philippe Soupault.

In a startup pitch style, it's a website generator for Markdown haters.

# Overview

There are lots of static website generators around already, and most of them are variations on a single theme:
"take a Markdown file, convert to HTML, and feed to a template processor".

Soupault turns this process inside out. It parses an HTML "template", inserts page content into
an element with a certain selector, and runs the HTML tree through one or more "widgets" (rewriters).

You can use any CSS3 selector to choose where the widget output is inserted (appended, to be precise)
and what it should take as its data source.

Right now it can:
* Include files, snippets, and output of external programs
* Set page title
* Insert breadcrumbs in nested sections
* Produce clean URLs for nested sections

Soupault is exactly a website generator, not a blog generator. Pages are first class entities,
and the source directory structure closely mirrors the output structure.
Every subdirectory of the site dir is a section, its subdirectories are subsections and so on.
A directory with an `index.html` page is created for every page not named `index` to provide
clean URLs, e.g. "site/foo/bar.html" turns into "build/foo/bar/index.html" so that it can be accessed
as `http://example.com/foo/bar`.

Note that if there's no index page in a section, soupault will not make one for you. Some simple
autoindexing will be added in the near future.

You can look into `sample-site/` for a halfway-realistic setup example.

# Getting started

You can initialize a basic project with `soupault --init` and build it by running `soupault`
without arguments.

# Directory structure

Website content is stored in a directory referred to as `site_dir`. By default it's `site/`.
Every subdirectory is a section. Every subdirectory of a subdirectory is a subsection and so on.

Page file extensions are not important. Everything is assumed to be an HTML page
(in the future, there will be support for calling preprocessor based on extensions).

Soupault's behaviour and settings are controlled by a config file named `soupault.conf`,
in the TOML format.

A sample structure:

```
sample-site/
├── site
│   ├── about.inc
│   └── index.inc
├── templates
│   └── main.html
└── soupault.conf
```

At build time, soupault will produce something like this from it:

```
build/
├── about
│   └── index.html
└── index.html

```

Templates are stored in a directory named `templates/` by convention. They can be stored anywhere,
but with default configuration soupault will look for `templates/main.html` file.
A "template" is simply an HTML file devoid of content. This is the minimum viable template:

```
<html>
  <head> </head>
  <body> </body>
</html>
```

By default soupault inserts the content into the `<body>` element, but you can use any
CSS3 selector to choose where it's inserted.

# Configuration

The default config is the following:

```
[settings]
  # Stop on page processing errors
  strict = true

  # Don't output debug info
  verbose = false

  # Where generated pages go
  build_dir = "build"

  # Where pages are stores
  site_dir = "site"

  default_template = "templates/main.html"

  # Where page content is inserted
  content_selector = "body"

  # DOCTYPE to set for generated pages
  doctype = "<!DOCTYPE html>"

```

The `content_selector` option can be any valid CSS3 selector. For example, `content_selector = "#content"`
will make soupalt insert the page content into the element with `id="content"`.

# Widgets

Soupault includes a number of built-in HTML rewriters that we'll call "widgets" for lack of a better word.

Right now the following widgets are supported:

* `include` (includes a file)
* `insert_html` (inserts HTML snippet from a string)
* `exec` (inserts stdout of an external pgoram)
* `title` (sets page title)
* `breadcrumbs`

Widget configs are stored in subtables of the `[widgets]` table. Subtable names are purely
informational, widget type is determined by the "widget" option.

Widgets are processed top down, and have access to content generated by previous widgets,
so you can use output of one widget as an input for another.

```
# Inserts contents of the first <h1> into <title>
[widgets.page-title]
  widget = "title"
  selector = "h1"
  default = "My Homepage"
  append = " on my website"
  prepend = "Page named "

# Includes a file into <div id="footer">
[widgets.nav-menu]
  widget = "include"
  selector = "div#footer"

  # Path relative to the project dir, not site/
  file = "includes/footer.html"

# Inserts output of `date -R`
[widgets.generated-on]
  widget = "exec"
  selector = "#generated-on"
  command = "date -R"

[widgets.tracking-script]
  widget = "insert_html"
  selector = "head"
  html = "<script src=\"/scripts/evil-tracking-script.js\"> </script>"

[widgets.breadcrumbs]
  widget = "breadcrumbs"
  selector = "#breadcrumbs"
  prepend = ".. / "
  append = " /"
  between = " / "
  breadcrumb_template = "<a class=\"nav\"></a>"

```

The `exec` widget passes the page file path in `$PAGE_FILE` environment variable,
which can be used for "last modified" scripts or custom processors.

## Limiting widgets to specific pages or sections

Widgets can be restricted to a specific page or section with `page` and `section` options.
Those options require page file and directory names, rather than logical URL paths.

You can use `page = "programming/goto-harmful.html"` or `section = "programming/".
[Warning: I haven't tested sections yet, page overrides do work]

```
# News only on the main page
[widgets.site-news]
  page = "index.html"

  widget = "include"
  file = "includes/news.html"
  selector = "body"

```

# Future plans

* ToC widget
* Footnotes widget
* Page content preprocessors
* Different templates for different sections/pages
* Incremental builds (?)
* Taxonomies (?)
* Dynlinking plugins (if feasible)
