os: osx

language: generic

env:
  - SWITCH=4.09.0
  - OPAM_VERSION=2.0.6
  - OPAM_PLATFORM="x86_64-macos"

before_script:
  - set -e
  - wget https://github.com/ocaml/opam/releases/download/$OPAM_VERSION/opam-$OPAM_VERSION-$OPAM_PLATFORM
  - sudo mv opam-$OPAM_VERSION-$OPAM_PLATFORM /usr/local/bin/opam
  - sudo chmod a+x /usr/local/bin/opam
  - opam init -y --compiler $SWITCH --disable-sandboxing
  - eval `opam env`
  - ocaml -version
  - opam pin add -y git+https://github.com/lindig/lua-ml

script:
  - opam pin add -y --no-action soupault .
  - opam install -y --destdir . soupault

notifications:
  email:
    recipients:
      - daniil+soupault@baturin.org
    on_success: always
on_failure: always

addons:
  artifacts:
    working_dir: bin
